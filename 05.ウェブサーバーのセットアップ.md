## ウェブサーバーのセットアップ

### Apacheの場合

設定を書き換える前にオリジナルをバックアップ。

```bash
[root@centos8 ~]# cp /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.orig
```

ディレクトリを作る。

```bash
[root@centos8 ~]# mkdir -p /var/www/vhosts /var/www/logs/httpd /var/www/session
[root@centos8 ~]# chown -R webmaster:webmaster /var/www
```

mod_phpの設定を変更する。
デフォルトの`session.save_path`は`/var/lib/php/session`となっているので、Apacheの耳垢ユーザーでは書き込めない。`/var/www/session`に書き換える。

```bash
[root@centos8 ~]# vi /etc/httpd/conf.d/php73-php.conf
 48     #php_value session.save_path    "/var/opt/remi/php73/lib/php/session"
 49     php_value session.save_path    "/var/www/session"
```

Apache 2.4ではNot Foundの場合に`/usr/share/httpd/noindex/`のファイルが使われるので、使われないようにする。
またUpdateで再度作成されないようにからファイルにしておく。

```bash
[root@centos8 ~]# mv /etc/httpd/conf.d/welcome.conf /etc/httpd/conf.d/welcome.conf.bk
[root@centos8 ~]# echo '' > /etc/httpd/conf.d/welcome.conf
```

Apacheの設定は以下を参考にする。

- [config/etc/httpd/conf/httpd.conf](config/etc/httpd/conf/httpd.conf)

```bash
[root@centos8 ~]# wget https://raw.githubusercontent.com/tomgoodsun/centos8_lamp_configs/master/config/etc/httpd/conf/httpd.conf -O /etc/httpd/conf/httpd.conf
```

またApache 2.4からは設定ファイルが細かく分割されている。デフォルトで問題となりそうなのはiconsディレクトリ。常にエラーログに記録されることが気になるなら以下のファイルのalias設定をコメントアウトすることをおすすめする。

```bash
[root@centos8 ~]# vi /etc/httpd/conf.d/autoindex.conf
 21 #Alias /icons/ "/usr/share/httpd/icons/"
```

設定を書き換えたらApacheの設定ファイルの書式を確認して、起動または再起動。

```bash
[root@centos7 ~]# systemctl enable httpd
[root@centos7 ~]# apachectl configtest
[root@centos7 ~]# systemctl start httpd
```

#### VirtualHostの設定ファイルをどこに設置するか

`/etc/httpd/conf.d`以下に番号（例：`00-localhost.conf`など）をつけて保存。

### nginxの場合

設定を書き換える前にオリジナルをバックアップ。

```bash
[root@centos8 ~]# cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.orig
[root@centos8 ~]# cp /etc/php-fpm.conf /etc/php-fpm.conf.orig
[root@centos8 ~]# cp /etc/php-fpm.d/www.conf /etc/php-fpm.d/www.conf.orig
```

nginxの設定は以下を参考にする。

- [config/etc/nginx/nginx.conf](config/etc/nginx/nginx.conf)

php-fpmの設定は以下を参考にする。

- [config/etc/php-fpm.conf](config/etc/php-fpm.conf)
- [config/etc/php-fpm.d/www.conf](config/etc/php-fpm.d/www.conf)

```bash
[root@centos8 ~]# systemctl enable nginx
[root@centos8 ~]# systemctl start nginx
[root@centos8 ~]# systemctl enable php-fpm
[root@centos8 ~]# systemctl start php-fpm
```
